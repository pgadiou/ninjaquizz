<div id="quiz" data-admin="<%= current_user == @quiz.user %>">
  <% if current_user == @quiz.user %>
    <% if @quiz.round_count < @quiz.no_of_rounds %>
      <div class="hidden-xs hidden-sm">
        <div class="container text-center welcome">
          <h1>Welcome to the game!</h1>
          <div class="row" id="new_team">
          </div>
        </div>
      </div>
      <div class="hidden-md hidden-lg">
        <div class="container text-center">
          <div class="row">
            <div class="col-xs-12">
              <div class="btn btn-control" id="next"><%= link_to "First round", round_path(@first_round), remote: true %></div>
            </div>
          </div>
        </div>
      </div>
    <% else %>
    <div class="container text-center">
        <h3><%= "Results" %></h3>
    </div>
    <% end %>
  <% else %>
  <div class="container text-center">
    <h1>Welcome to the game!</h1>
  </div>
  <% end %>
</div>

<% content_for :after_js do %>
  <script>

    const onAnswerSelect = () => {
      const answers = document.getElementsByClassName("card-answer");

      const answerSelect = () => {
        for (var i = 0; i< answers.length; i++) {
          answers[i].classList.add("unselected_answer", "disabled_item");
          event.currentTarget.classList.remove("unselected_answer");
          event.currentTarget.classList.add("selected_answer");
        }

        event.currentTarget.classList.add("selected_answer");
        console.log("coucou");
      };

      for (var i = 0; i< answers.length; i++) {
        answers[i].addEventListener("click", answerSelect);
      }
    }

    App['quiz_room_<%= @quiz.id %>'] = App.cable.subscriptions.create(
      { channel: 'QuizRoomChannel', quiz_room_id: <%= @quiz.id %> },
      { received: (data) => {
        console.log("event");
        quiz = document.getElementById("quiz");
        if (quiz.dataset.admin == "true") {
          if (data.event == "new_team") {
            new_team = document.getElementById("new_team");
            new_team.insertAdjacentHTML("afterbegin", data.admin_partial);
          }
          else {
            quiz.innerHTML = data.admin_partial;
          }
        }
        else {
          quiz.innerHTML = data.player_partial;
          onAnswerSelect();
        }
        }
      })
  </script>
<% end %>
